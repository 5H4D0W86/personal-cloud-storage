<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Cloud Storage</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .upload-area { border: 2px dashed #007bff; padding: 40px; text-align: center; margin: 20px 0; border-radius: 8px; cursor: pointer; transition: all 0.3s; }
        .upload-area:hover { border-color: #0056b3; background: #f8f9fa; }
        .upload-area.dragover { border-color: #0056b3; background: #e3f2fd; }
        .file-input { display: none; }
        .status { margin: 20px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .loading { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .file-list { margin-top: 20px; }
        .file-item { padding: 10px; border: 1px solid #ddd; margin: 5px 0; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const API_ENDPOINT = 'https://bthp771k53.execute-api.us-west-1.amazonaws.com/prod/upload';

        function App() {
            const [status, setStatus] = useState('');
            const [statusType, setStatusType] = useState('');
            const [dragOver, setDragOver] = useState(false);

            const showStatus = (message, type) => {
                setStatus(message);
                setStatusType(type);
                setTimeout(() => setStatus(''), 5000);
            };

            const uploadFile = async (file) => {
                setStatus('Uploading...');
                setStatusType('loading');

                try {
                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        const base64Content = btoa(e.target.result);
                        
                        const response = await fetch(API_ENDPOINT, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                fileName: file.name,
                                fileContent: base64Content,
                                contentType: file.type || 'application/octet-stream'
                            })
                        });

                        const result = await response.json();

                        if (response.ok) {
                            showStatus(`File ${file.name} uploaded successfully!`, 'success');
                        } else {
                            showStatus(`Upload failed: ${result.error || 'Unknown error'}`, 'error');
                        }
                    };
                    reader.readAsBinaryString(file);
                } catch (error) {
                    showStatus(`Upload failed: ${error.message}`, 'error');
                }
            };

            const handleFileSelect = (e) => {
                const files = e.target.files;
                if (files.length > 0) {
                    uploadFile(files[0]);
                }
            };

            const handleDrop = (e) => {
                e.preventDefault();
                setDragOver(false);
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    uploadFile(files[0]);
                }
            };

            const handleDragOver = (e) => {
                e.preventDefault();
                setDragOver(true);
            };

            const handleDragLeave = () => {
                setDragOver(false);
            };

            return (
                <div className="container">
                    <h1>Personal Cloud Storage</h1>
                    <p>Upload files to your serverless cloud storage!</p>
                    
                    <div 
                        className={`upload-area ${dragOver ? 'dragover' : ''}`}
                        onDrop={handleDrop}
                        onDragOver={handleDragOver}
                        onDragLeave={handleDragLeave}
                        onClick={() => document.getElementById('fileInput').click()}
                    >
                        <div>
                            <h3>Drop files here or click to upload</h3>
                            <p>Powered by AWS Lambda + S3</p>
                        </div>
                        <input
                            id="fileInput"
                            type="file"
                            className="file-input"
                            onChange={handleFileSelect}
                        />
                    </div>

                    {status && (
                        <div className={`status ${statusType}`}>
                            {status}
                        </div>
                    )}

                    <div className="file-list">
                        <h3>API Endpoint</h3>
                        <div className="file-item">
                            <code style={{fontSize: '12px', color: '#666'}}>
                                {API_ENDPOINT}
                            </code>
                            <span style={{color: '#28a745', fontWeight: 'bold'}}>LIVE</span>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
